"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/upload/merge";
exports.ids = ["pages/api/upload/merge"];
exports.modules = {

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload%2Fmerge&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cupload%5Cmerge.ts&middlewareConfigBase64=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload%2Fmerge&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cupload%5Cmerge.ts&middlewareConfigBase64=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_upload_merge_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\upload\\merge.ts */ \"(api)/./pages/api/upload/merge.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_upload_merge_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_upload_merge_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/upload/merge\",\n        pathname: \"/api/upload/merge\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_upload_merge_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnVwbG9hZCUyRm1lcmdlJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUN1cGxvYWQlNUNtZXJnZS50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUMyRDtBQUMzRDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsdURBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLHVEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCIsInNvdXJjZXMiOlsid2VicGFjazovL215X3ByYS8/ZmU0MyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXHVwbG9hZFxcXFxtZXJnZS50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3VwbG9hZC9tZXJnZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3VwbG9hZC9tZXJnZVwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload%2Fmerge&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cupload%5Cmerge.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./middleware/auth.ts":
/*!****************************!*\
  !*** ./middleware/auth.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authMiddleware: () => (/* binding */ authMiddleware),\n/* harmony export */   roleCheck: () => (/* binding */ roleCheck)\n/* harmony export */ });\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__);\n\nfunction authMiddleware(handler) {\n    return async (req, res)=>{\n        try {\n            const authHeader = req.headers.authorization;\n            if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n                return res.status(401).json({\n                    code: 401,\n                    message: \"未提供token\",\n                    data: null\n                });\n            }\n            const token = authHeader.split(\" \")[1];\n            const secret = process.env.JWT_SECRET || \"your-secret-key\";\n            try {\n                const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().verify(token, secret);\n                // 将解码后的用户信息添加到请求对象中\n                req.user = decoded;\n                return handler(req, res);\n            } catch (error) {\n                return res.status(401).json({\n                    code: 401,\n                    message: \"无效的token\",\n                    data: null\n                });\n            }\n        } catch (error) {\n            return res.status(500).json({\n                code: 500,\n                message: \"服务器错误\",\n                data: null\n            });\n        }\n    };\n}\nfunction roleCheck(roles) {\n    return (handler)=>{\n        return async (req, res)=>{\n            try {\n                const user = req.user;\n                if (!user) {\n                    return res.status(401).json({\n                        code: 401,\n                        message: \"请先登录\",\n                        data: null\n                    });\n                }\n                if (!roles.includes(user.role)) {\n                    return res.status(403).json({\n                        code: 403,\n                        message: \"权限不足\",\n                        data: null\n                    });\n                }\n                return handler(req, res);\n            } catch (error) {\n                return res.status(500).json({\n                    code: 500,\n                    message: \"服务器错误\",\n                    data: null\n                });\n            }\n        };\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9taWRkbGV3YXJlL2F1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUMrQjtBQVF4QixTQUFTQyxlQUFlQyxPQUFZO0lBQ3pDLE9BQU8sT0FBT0MsS0FBcUJDO1FBQ2pDLElBQUk7WUFDRixNQUFNQyxhQUFhRixJQUFJRyxPQUFPLENBQUNDLGFBQWE7WUFFNUMsSUFBSSxDQUFDRixjQUFjLENBQUNBLFdBQVdHLFVBQVUsQ0FBQyxZQUFZO2dCQUNwRCxPQUFPSixJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO29CQUMxQkMsTUFBTTtvQkFDTkMsU0FBUztvQkFDVEMsTUFBTTtnQkFDUjtZQUNGO1lBRUEsTUFBTUMsUUFBUVQsV0FBV1UsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3RDLE1BQU1DLFNBQVNDLFFBQVFDLEdBQUcsQ0FBQ0MsVUFBVSxJQUFJO1lBRXpDLElBQUk7Z0JBQ0YsTUFBTUMsVUFBVXBCLDBEQUFVLENBQUNjLE9BQU9FO2dCQUVsQyxvQkFBb0I7Z0JBQ25CYixJQUFZbUIsSUFBSSxHQUFHRjtnQkFFcEIsT0FBT2xCLFFBQVFDLEtBQUtDO1lBQ3RCLEVBQUUsT0FBT21CLE9BQU87Z0JBQ2QsT0FBT25CLElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQzFCQyxNQUFNO29CQUNOQyxTQUFTO29CQUNUQyxNQUFNO2dCQUNSO1lBQ0Y7UUFDRixFQUFFLE9BQU9VLE9BQU87WUFDZCxPQUFPbkIsSUFBSUssTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFDMUJDLE1BQU07Z0JBQ05DLFNBQVM7Z0JBQ1RDLE1BQU07WUFDUjtRQUNGO0lBQ0Y7QUFDRjtBQUVPLFNBQVNXLFVBQVVDLEtBQWU7SUFDdkMsT0FBTyxDQUFDdkI7UUFDTixPQUFPLE9BQU9DLEtBQXFCQztZQUNqQyxJQUFJO2dCQUNGLE1BQU1rQixPQUFPLElBQWFBLElBQUk7Z0JBRTlCLElBQUksQ0FBQ0EsTUFBTTtvQkFDVCxPQUFPbEIsSUFBSUssTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQzt3QkFDMUJDLE1BQU07d0JBQ05DLFNBQVM7d0JBQ1RDLE1BQU07b0JBQ1I7Z0JBQ0Y7Z0JBRUEsSUFBSSxDQUFDWSxNQUFNQyxRQUFRLENBQUNKLEtBQUtLLElBQUksR0FBRztvQkFDOUIsT0FBT3ZCLElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7d0JBQzFCQyxNQUFNO3dCQUNOQyxTQUFTO3dCQUNUQyxNQUFNO29CQUNSO2dCQUNGO2dCQUVBLE9BQU9YLFFBQVFDLEtBQUtDO1lBQ3RCLEVBQUUsT0FBT21CLE9BQU87Z0JBQ2QsT0FBT25CLElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQzFCQyxNQUFNO29CQUNOQyxTQUFTO29CQUNUQyxNQUFNO2dCQUNSO1lBQ0Y7UUFDRjtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9teV9wcmEvLi9taWRkbGV3YXJlL2F1dGgudHM/NDhjMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSBcIm5leHRcIjtcclxuaW1wb3J0IGp3dCBmcm9tIFwianNvbndlYnRva2VuXCI7XHJcblxyXG5pbnRlcmZhY2UgRGVjb2RlZFRva2VuIHtcclxuICB1c2VySWQ6IHN0cmluZztcclxuICB1c2VybmFtZTogc3RyaW5nO1xyXG4gIHJvbGU6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGF1dGhNaWRkbGV3YXJlKGhhbmRsZXI6IGFueSkge1xyXG4gIHJldHVybiBhc3luYyAocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xyXG5cclxuICAgICAgaWYgKCFhdXRoSGVhZGVyIHx8ICFhdXRoSGVhZGVyLnN0YXJ0c1dpdGgoXCJCZWFyZXIgXCIpKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcclxuICAgICAgICAgIGNvZGU6IDQwMSxcclxuICAgICAgICAgIG1lc3NhZ2U6IFwi5pyq5o+Q5L6bdG9rZW5cIixcclxuICAgICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlci5zcGxpdChcIiBcIilbMV07XHJcbiAgICAgIGNvbnN0IHNlY3JldCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgXCJ5b3VyLXNlY3JldC1rZXlcIjtcclxuXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIHNlY3JldCkgYXMgRGVjb2RlZFRva2VuO1xyXG5cclxuICAgICAgICAvLyDlsIbop6PnoIHlkI7nmoTnlKjmiLfkv6Hmga/mt7vliqDliLDor7fmsYLlr7nosaHkuK1cclxuICAgICAgICAocmVxIGFzIGFueSkudXNlciA9IGRlY29kZWQ7XHJcblxyXG4gICAgICAgIHJldHVybiBoYW5kbGVyKHJlcSwgcmVzKTtcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xyXG4gICAgICAgICAgY29kZTogNDAxLFxyXG4gICAgICAgICAgbWVzc2FnZTogXCLml6DmlYjnmoR0b2tlblwiLFxyXG4gICAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICBjb2RlOiA1MDAsXHJcbiAgICAgICAgbWVzc2FnZTogXCLmnI3liqHlmajplJnor69cIixcclxuICAgICAgICBkYXRhOiBudWxsLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcm9sZUNoZWNrKHJvbGVzOiBzdHJpbmdbXSkge1xyXG4gIHJldHVybiAoaGFuZGxlcjogYW55KSA9PiB7XHJcbiAgICByZXR1cm4gYXN5bmMgKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSA9PiB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgdXNlciA9IChyZXEgYXMgYW55KS51c2VyO1xyXG5cclxuICAgICAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XHJcbiAgICAgICAgICAgIGNvZGU6IDQwMSxcclxuICAgICAgICAgICAgbWVzc2FnZTogXCLor7flhYjnmbvlvZVcIixcclxuICAgICAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFyb2xlcy5pbmNsdWRlcyh1c2VyLnJvbGUpKSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xyXG4gICAgICAgICAgICBjb2RlOiA0MDMsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwi5p2D6ZmQ5LiN6LazXCIsXHJcbiAgICAgICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBoYW5kbGVyKHJlcSwgcmVzKTtcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgY29kZTogNTAwLFxyXG4gICAgICAgICAgbWVzc2FnZTogXCLmnI3liqHlmajplJnor69cIixcclxuICAgICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfTtcclxufVxyXG4iXSwibmFtZXMiOlsiand0IiwiYXV0aE1pZGRsZXdhcmUiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwic3RhcnRzV2l0aCIsInN0YXR1cyIsImpzb24iLCJjb2RlIiwibWVzc2FnZSIsImRhdGEiLCJ0b2tlbiIsInNwbGl0Iiwic2VjcmV0IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJkZWNvZGVkIiwidmVyaWZ5IiwidXNlciIsImVycm9yIiwicm9sZUNoZWNrIiwicm9sZXMiLCJpbmNsdWRlcyIsInJvbGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./middleware/auth.ts\n");

/***/ }),

/***/ "(api)/./pages/api/upload/merge.ts":
/*!***********************************!*\
  !*** ./pages/api/upload/merge.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _middleware_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../middleware/auth */ \"(api)/./middleware/auth.ts\");\n\n\n\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            code: 405,\n            message: \"方法不允许\",\n            data: null\n        });\n    }\n    try {\n        const { fileName, chunks } = req.body;\n        if (!fileName || !chunks) {\n            return res.status(400).json({\n                code: 400,\n                message: \"参数不完整\",\n                data: null\n            });\n        }\n        const tempDir = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"uploads\", \"temp\", fileName);\n        const uploadDir = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"uploads\", \"files\");\n        // 确保上传目录存在\n        if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(uploadDir)) {\n            fs__WEBPACK_IMPORTED_MODULE_0___default().mkdirSync(uploadDir, {\n                recursive: true\n            });\n        }\n        // 检查所有分片是否存在\n        for(let i = 0; i < parseInt(chunks); i++){\n            const chunkPath = path__WEBPACK_IMPORTED_MODULE_1___default().join(tempDir, `${i}`);\n            if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(chunkPath)) {\n                return res.status(400).json({\n                    code: 400,\n                    message: `分片 ${i} 缺失，合并失败`,\n                    data: null\n                });\n            }\n        }\n        // 合并文件\n        const filePath = path__WEBPACK_IMPORTED_MODULE_1___default().join(uploadDir, fileName);\n        const writeStream = fs__WEBPACK_IMPORTED_MODULE_0___default().createWriteStream(filePath);\n        for(let i = 0; i < parseInt(chunks); i++){\n            const chunkPath = path__WEBPACK_IMPORTED_MODULE_1___default().join(tempDir, `${i}`);\n            const chunkData = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(chunkPath);\n            writeStream.write(chunkData);\n            // 删除分片\n            fs__WEBPACK_IMPORTED_MODULE_0___default().unlinkSync(chunkPath);\n        }\n        writeStream.end();\n        // 删除临时目录\n        fs__WEBPACK_IMPORTED_MODULE_0___default().rmdirSync(tempDir);\n        // 生成文件URL (在实际环境中，这应该是通过CDN或其他文件服务生成)\n        const fileUrl = `/uploads/files/${fileName}`;\n        return res.status(200).json({\n            code: 200,\n            message: \"文件合并成功\",\n            data: {\n                url: fileUrl\n            }\n        });\n    } catch (error) {\n        console.error(error);\n        return res.status(500).json({\n            code: 500,\n            message: \"服务器错误\",\n            data: null\n        });\n    }\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_middleware_auth__WEBPACK_IMPORTED_MODULE_2__.authMiddleware)(handler));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvdXBsb2FkL21lcmdlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUNvQjtBQUNJO0FBQ2tDO0FBRTFELGVBQWVHLFFBQVFDLEdBQW1CLEVBQUVDLEdBQW9CO0lBQzlELElBQUlELElBQUlFLE1BQU0sS0FBSyxRQUFRO1FBQ3pCLE9BQU9ELElBQ0pFLE1BQU0sQ0FBQyxLQUNQQyxJQUFJLENBQUM7WUFBRUMsTUFBTTtZQUFLQyxTQUFTO1lBQVNDLE1BQU07UUFBSztJQUNwRDtJQUVBLElBQUk7UUFDRixNQUFNLEVBQUVDLFFBQVEsRUFBRUMsTUFBTSxFQUFFLEdBQUdULElBQUlVLElBQUk7UUFFckMsSUFBSSxDQUFDRixZQUFZLENBQUNDLFFBQVE7WUFDeEIsT0FBT1IsSUFDSkUsTUFBTSxDQUFDLEtBQ1BDLElBQUksQ0FBQztnQkFBRUMsTUFBTTtnQkFBS0MsU0FBUztnQkFBU0MsTUFBTTtZQUFLO1FBQ3BEO1FBRUEsTUFBTUksVUFBVWQsZ0RBQVMsQ0FBQ2dCLFFBQVFDLEdBQUcsSUFBSSxXQUFXLFFBQVFOO1FBQzVELE1BQU1PLFlBQVlsQixnREFBUyxDQUFDZ0IsUUFBUUMsR0FBRyxJQUFJLFdBQVc7UUFFdEQsV0FBVztRQUNYLElBQUksQ0FBQ2xCLG9EQUFhLENBQUNtQixZQUFZO1lBQzdCbkIsbURBQVksQ0FBQ21CLFdBQVc7Z0JBQUVHLFdBQVc7WUFBSztRQUM1QztRQUVBLGFBQWE7UUFDYixJQUFLLElBQUlDLElBQUksR0FBR0EsSUFBSUMsU0FBU1gsU0FBU1UsSUFBSztZQUN6QyxNQUFNRSxZQUFZeEIsZ0RBQVMsQ0FBQ2MsU0FBUyxDQUFDLEVBQUVRLEVBQUUsQ0FBQztZQUMzQyxJQUFJLENBQUN2QixvREFBYSxDQUFDeUIsWUFBWTtnQkFDN0IsT0FBT3BCLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQzFCQyxNQUFNO29CQUNOQyxTQUFTLENBQUMsR0FBRyxFQUFFYSxFQUFFLFFBQVEsQ0FBQztvQkFDMUJaLE1BQU07Z0JBQ1I7WUFDRjtRQUNGO1FBRUEsT0FBTztRQUNQLE1BQU1lLFdBQVd6QixnREFBUyxDQUFDa0IsV0FBV1A7UUFDdEMsTUFBTWUsY0FBYzNCLDJEQUFvQixDQUFDMEI7UUFFekMsSUFBSyxJQUFJSCxJQUFJLEdBQUdBLElBQUlDLFNBQVNYLFNBQVNVLElBQUs7WUFDekMsTUFBTUUsWUFBWXhCLGdEQUFTLENBQUNjLFNBQVMsQ0FBQyxFQUFFUSxFQUFFLENBQUM7WUFDM0MsTUFBTU0sWUFBWTdCLHNEQUFlLENBQUN5QjtZQUNsQ0UsWUFBWUksS0FBSyxDQUFDRjtZQUNsQixPQUFPO1lBQ1A3QixvREFBYSxDQUFDeUI7UUFDaEI7UUFFQUUsWUFBWU0sR0FBRztRQUVmLFNBQVM7UUFDVGpDLG1EQUFZLENBQUNlO1FBRWIsc0NBQXNDO1FBQ3RDLE1BQU1vQixVQUFVLENBQUMsZUFBZSxFQUFFdkIsU0FBUyxDQUFDO1FBRTVDLE9BQU9QLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFDMUJDLE1BQU07WUFDTkMsU0FBUztZQUNUQyxNQUFNO2dCQUNKeUIsS0FBS0Q7WUFDUDtRQUNGO0lBQ0YsRUFBRSxPQUFPRSxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQ0E7UUFDZCxPQUFPaEMsSUFDSkUsTUFBTSxDQUFDLEtBQ1BDLElBQUksQ0FBQztZQUFFQyxNQUFNO1lBQUtDLFNBQVM7WUFBU0MsTUFBTTtRQUFLO0lBQ3BEO0FBQ0Y7QUFFQSxpRUFBZVQsZ0VBQWNBLENBQUNDLFFBQVFBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9teV9wcmEvLi9wYWdlcy9hcGkvdXBsb2FkL21lcmdlLnRzPzVjYWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSBcIm5leHRcIjtcclxuaW1wb3J0IGZzIGZyb20gXCJmc1wiO1xyXG5pbXBvcnQgcGF0aCBmcm9tIFwicGF0aFwiO1xyXG5pbXBvcnQgeyBhdXRoTWlkZGxld2FyZSB9IGZyb20gXCIuLi8uLi8uLi9taWRkbGV3YXJlL2F1dGhcIjtcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcclxuICBpZiAocmVxLm1ldGhvZCAhPT0gXCJQT1NUXCIpIHtcclxuICAgIHJldHVybiByZXNcclxuICAgICAgLnN0YXR1cyg0MDUpXHJcbiAgICAgIC5qc29uKHsgY29kZTogNDA1LCBtZXNzYWdlOiBcIuaWueazleS4jeWFgeiuuFwiLCBkYXRhOiBudWxsIH0pO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgZmlsZU5hbWUsIGNodW5rcyB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgaWYgKCFmaWxlTmFtZSB8fCAhY2h1bmtzKSB7XHJcbiAgICAgIHJldHVybiByZXNcclxuICAgICAgICAuc3RhdHVzKDQwMClcclxuICAgICAgICAuanNvbih7IGNvZGU6IDQwMCwgbWVzc2FnZTogXCLlj4LmlbDkuI3lrozmlbRcIiwgZGF0YTogbnVsbCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0ZW1wRGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIFwidXBsb2Fkc1wiLCBcInRlbXBcIiwgZmlsZU5hbWUpO1xyXG4gICAgY29uc3QgdXBsb2FkRGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIFwidXBsb2Fkc1wiLCBcImZpbGVzXCIpO1xyXG5cclxuICAgIC8vIOehruS/neS4iuS8oOebruW9leWtmOWcqFxyXG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKHVwbG9hZERpcikpIHtcclxuICAgICAgZnMubWtkaXJTeW5jKHVwbG9hZERpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5qOA5p+l5omA5pyJ5YiG54mH5piv5ZCm5a2Y5ZyoXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcnNlSW50KGNodW5rcyk7IGkrKykge1xyXG4gICAgICBjb25zdCBjaHVua1BhdGggPSBwYXRoLmpvaW4odGVtcERpciwgYCR7aX1gKTtcclxuICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKGNodW5rUGF0aCkpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgICAgY29kZTogNDAwLFxyXG4gICAgICAgICAgbWVzc2FnZTogYOWIhueJhyAke2l9IOe8uuWkse+8jOWQiOW5tuWksei0pWAsXHJcbiAgICAgICAgICBkYXRhOiBudWxsLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5ZCI5bm25paH5Lu2XHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IHBhdGguam9pbih1cGxvYWREaXIsIGZpbGVOYW1lKTtcclxuICAgIGNvbnN0IHdyaXRlU3RyZWFtID0gZnMuY3JlYXRlV3JpdGVTdHJlYW0oZmlsZVBhdGgpO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFyc2VJbnQoY2h1bmtzKTsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IGNodW5rUGF0aCA9IHBhdGguam9pbih0ZW1wRGlyLCBgJHtpfWApO1xyXG4gICAgICBjb25zdCBjaHVua0RhdGEgPSBmcy5yZWFkRmlsZVN5bmMoY2h1bmtQYXRoKTtcclxuICAgICAgd3JpdGVTdHJlYW0ud3JpdGUoY2h1bmtEYXRhKTtcclxuICAgICAgLy8g5Yig6Zmk5YiG54mHXHJcbiAgICAgIGZzLnVubGlua1N5bmMoY2h1bmtQYXRoKTtcclxuICAgIH1cclxuXHJcbiAgICB3cml0ZVN0cmVhbS5lbmQoKTtcclxuXHJcbiAgICAvLyDliKDpmaTkuLTml7bnm67lvZVcclxuICAgIGZzLnJtZGlyU3luYyh0ZW1wRGlyKTtcclxuXHJcbiAgICAvLyDnlJ/miJDmlofku7ZVUkwgKOWcqOWunumZheeOr+Wig+S4re+8jOi/meW6lOivpeaYr+mAmui/h0NETuaIluWFtuS7luaWh+S7tuacjeWKoeeUn+aIkClcclxuICAgIGNvbnN0IGZpbGVVcmwgPSBgL3VwbG9hZHMvZmlsZXMvJHtmaWxlTmFtZX1gO1xyXG5cclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgIGNvZGU6IDIwMCxcclxuICAgICAgbWVzc2FnZTogXCLmlofku7blkIjlubbmiJDlip9cIixcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIHVybDogZmlsZVVybCxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIHJldHVybiByZXNcclxuICAgICAgLnN0YXR1cyg1MDApXHJcbiAgICAgIC5qc29uKHsgY29kZTogNTAwLCBtZXNzYWdlOiBcIuacjeWKoeWZqOmUmeivr1wiLCBkYXRhOiBudWxsIH0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXV0aE1pZGRsZXdhcmUoaGFuZGxlcik7XHJcbiJdLCJuYW1lcyI6WyJmcyIsInBhdGgiLCJhdXRoTWlkZGxld2FyZSIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJzdGF0dXMiLCJqc29uIiwiY29kZSIsIm1lc3NhZ2UiLCJkYXRhIiwiZmlsZU5hbWUiLCJjaHVua3MiLCJib2R5IiwidGVtcERpciIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwidXBsb2FkRGlyIiwiZXhpc3RzU3luYyIsIm1rZGlyU3luYyIsInJlY3Vyc2l2ZSIsImkiLCJwYXJzZUludCIsImNodW5rUGF0aCIsImZpbGVQYXRoIiwid3JpdGVTdHJlYW0iLCJjcmVhdGVXcml0ZVN0cmVhbSIsImNodW5rRGF0YSIsInJlYWRGaWxlU3luYyIsIndyaXRlIiwidW5saW5rU3luYyIsImVuZCIsInJtZGlyU3luYyIsImZpbGVVcmwiLCJ1cmwiLCJlcnJvciIsImNvbnNvbGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/upload/merge.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload%2Fmerge&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cupload%5Cmerge.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();