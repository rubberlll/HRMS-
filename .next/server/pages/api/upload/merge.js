"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/upload/merge";
exports.ids = ["pages/api/upload/merge"];
exports.modules = {

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload%2Fmerge&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cupload%5Cmerge.ts&middlewareConfigBase64=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload%2Fmerge&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cupload%5Cmerge.ts&middlewareConfigBase64=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_upload_merge_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\upload\\merge.ts */ \"(api)/./pages/api/upload/merge.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_upload_merge_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_upload_merge_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/upload/merge\",\n        pathname: \"/api/upload/merge\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_upload_merge_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnVwbG9hZCUyRm1lcmdlJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUN1cGxvYWQlNUNtZXJnZS50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUMyRDtBQUMzRDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsdURBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLHVEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCIsInNvdXJjZXMiOlsid2VicGFjazovL215X3ByYS8/ZmU0MyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXHVwbG9hZFxcXFxtZXJnZS50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3VwbG9hZC9tZXJnZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3VwbG9hZC9tZXJnZVwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload%2Fmerge&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cupload%5Cmerge.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./middleware/auth.ts":
/*!****************************!*\
  !*** ./middleware/auth.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authMiddleware: () => (/* binding */ authMiddleware),\n/* harmony export */   roleCheck: () => (/* binding */ roleCheck)\n/* harmony export */ });\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__);\n\nfunction authMiddleware(handler) {\n    return async (req, res)=>{\n        try {\n            const authHeader = req.headers.authorization;\n            if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n                return res.status(401).json({\n                    code: 401,\n                    message: \"未提供token\",\n                    data: null\n                });\n            }\n            const token = authHeader.split(\" \")[1];\n            const secret = process.env.JWT_SECRET;\n            if (!secret) {\n                console.error(\"警告: JWT_SECRET 环境变量未设置\");\n                return res.status(500).json({\n                    code: 500,\n                    message: \"服务器配置错误\",\n                    data: null\n                });\n            }\n            try {\n                const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().verify(token, secret);\n                req.user = decoded;\n                return handler(req, res);\n            } catch (error) {\n                return res.status(401).json({\n                    code: 401,\n                    message: \"无效的token\",\n                    data: null\n                });\n            }\n        } catch (error) {\n            console.error(\"认证中间件错误:\", error);\n            return res.status(500).json({\n                code: 500,\n                message: \"服务器错误\",\n                data: null\n            });\n        }\n    };\n}\nfunction roleCheck(roles) {\n    return (handler)=>{\n        return async (req, res)=>{\n            try {\n                const user = req.user;\n                if (!user) {\n                    return res.status(401).json({\n                        code: 401,\n                        message: \"请先登录\",\n                        data: null\n                    });\n                }\n                if (!roles.includes(user.role)) {\n                    return res.status(403).json({\n                        code: 403,\n                        message: \"权限不足\",\n                        data: null\n                    });\n                }\n                return handler(req, res);\n            } catch (error) {\n                console.error(\"角色检查中间件错误:\", error);\n                return res.status(500).json({\n                    code: 500,\n                    message: \"服务器错误\",\n                    data: null\n                });\n            }\n        };\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9taWRkbGV3YXJlL2F1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUMrQjtBQWtCeEIsU0FBU0MsZUFBZUMsT0FBbUI7SUFDaEQsT0FBTyxPQUFPQyxLQUEyQkM7UUFDdkMsSUFBSTtZQUNGLE1BQU1DLGFBQWFGLElBQUlHLE9BQU8sQ0FBQ0MsYUFBYTtZQUU1QyxJQUFJLENBQUNGLGNBQWMsQ0FBQ0EsV0FBV0csVUFBVSxDQUFDLFlBQVk7Z0JBQ3BELE9BQU9KLElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQzFCQyxNQUFNO29CQUNOQyxTQUFTO29CQUNUQyxNQUFNO2dCQUNSO1lBQ0Y7WUFFQSxNQUFNQyxRQUFRVCxXQUFXVSxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDdEMsTUFBTUMsU0FBU0MsUUFBUUMsR0FBRyxDQUFDQyxVQUFVO1lBRXJDLElBQUksQ0FBQ0gsUUFBUTtnQkFDWEksUUFBUUMsS0FBSyxDQUFDO2dCQUNkLE9BQU9qQixJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO29CQUMxQkMsTUFBTTtvQkFDTkMsU0FBUztvQkFDVEMsTUFBTTtnQkFDUjtZQUNGO1lBRUEsSUFBSTtnQkFDRixNQUFNUyxVQUFVdEIsMERBQVUsQ0FBQ2MsT0FBT0U7Z0JBQ2xDYixJQUFJcUIsSUFBSSxHQUFHRjtnQkFDWCxPQUFPcEIsUUFBUUMsS0FBS0M7WUFDdEIsRUFBRSxPQUFPaUIsT0FBTztnQkFDZCxPQUFPakIsSUFBSUssTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFDMUJDLE1BQU07b0JBQ05DLFNBQVM7b0JBQ1RDLE1BQU07Z0JBQ1I7WUFDRjtRQUNGLEVBQUUsT0FBT1EsT0FBTztZQUNkRCxRQUFRQyxLQUFLLENBQUMsWUFBWUE7WUFDMUIsT0FBT2pCLElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQzFCQyxNQUFNO2dCQUNOQyxTQUFTO2dCQUNUQyxNQUFNO1lBQ1I7UUFDRjtJQUNGO0FBQ0Y7QUFFTyxTQUFTWSxVQUFVQyxLQUFlO0lBQ3ZDLE9BQU8sQ0FBQ3hCO1FBQ04sT0FBTyxPQUFPQyxLQUEyQkM7WUFDdkMsSUFBSTtnQkFDRixNQUFNb0IsT0FBT3JCLElBQUlxQixJQUFJO2dCQUVyQixJQUFJLENBQUNBLE1BQU07b0JBQ1QsT0FBT3BCLElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7d0JBQzFCQyxNQUFNO3dCQUNOQyxTQUFTO3dCQUNUQyxNQUFNO29CQUNSO2dCQUNGO2dCQUVBLElBQUksQ0FBQ2EsTUFBTUMsUUFBUSxDQUFDSCxLQUFLSSxJQUFJLEdBQUc7b0JBQzlCLE9BQU94QixJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO3dCQUMxQkMsTUFBTTt3QkFDTkMsU0FBUzt3QkFDVEMsTUFBTTtvQkFDUjtnQkFDRjtnQkFFQSxPQUFPWCxRQUFRQyxLQUFLQztZQUN0QixFQUFFLE9BQU9pQixPQUFPO2dCQUNkRCxRQUFRQyxLQUFLLENBQUMsY0FBY0E7Z0JBQzVCLE9BQU9qQixJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO29CQUMxQkMsTUFBTTtvQkFDTkMsU0FBUztvQkFDVEMsTUFBTTtnQkFDUjtZQUNGO1FBQ0Y7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXlfcHJhLy4vbWlkZGxld2FyZS9hdXRoLnRzPzQ4YzAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gXCJuZXh0XCI7XHJcbmltcG9ydCBqd3QgZnJvbSBcImpzb253ZWJ0b2tlblwiO1xyXG5cclxuaW50ZXJmYWNlIERlY29kZWRUb2tlbiB7XHJcbiAgdXNlcklkOiBzdHJpbmc7XHJcbiAgdXNlcm5hbWU6IHN0cmluZztcclxuICByb2xlOiBzdHJpbmc7XHJcbn1cclxuXHJcbi8vIOaJqeWxlSBOZXh0QXBpUmVxdWVzdCDnsbvlnovvvIzmt7vliqAgdXNlciDlsZ7mgKdcclxuZXhwb3J0IGludGVyZmFjZSBBdXRoZW50aWNhdGVkUmVxdWVzdCBleHRlbmRzIE5leHRBcGlSZXF1ZXN0IHtcclxuICB1c2VyPzogRGVjb2RlZFRva2VuO1xyXG59XHJcblxyXG50eXBlIEFwaUhhbmRsZXIgPSAoXHJcbiAgcmVxOiBBdXRoZW50aWNhdGVkUmVxdWVzdCxcclxuICByZXM6IE5leHRBcGlSZXNwb25zZVxyXG4pID0+IFByb21pc2U8dm9pZD4gfCB2b2lkO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGF1dGhNaWRkbGV3YXJlKGhhbmRsZXI6IEFwaUhhbmRsZXIpIHtcclxuICByZXR1cm4gYXN5bmMgKHJlcTogQXV0aGVudGljYXRlZFJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBhdXRoSGVhZGVyID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbjtcclxuXHJcbiAgICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKFwiQmVhcmVyIFwiKSkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XHJcbiAgICAgICAgICBjb2RlOiA0MDEsXHJcbiAgICAgICAgICBtZXNzYWdlOiBcIuacquaPkOS+m3Rva2VuXCIsXHJcbiAgICAgICAgICBkYXRhOiBudWxsLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc3BsaXQoXCIgXCIpWzFdO1xyXG4gICAgICBjb25zdCBzZWNyZXQgPSBwcm9jZXNzLmVudi5KV1RfU0VDUkVUO1xyXG5cclxuICAgICAgaWYgKCFzZWNyZXQpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwi6K2m5ZGKOiBKV1RfU0VDUkVUIOeOr+Wig+WPmOmHj+acquiuvue9rlwiKTtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgY29kZTogNTAwLFxyXG4gICAgICAgICAgbWVzc2FnZTogXCLmnI3liqHlmajphY3nva7plJnor69cIixcclxuICAgICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIHNlY3JldCkgYXMgRGVjb2RlZFRva2VuO1xyXG4gICAgICAgIHJlcS51c2VyID0gZGVjb2RlZDtcclxuICAgICAgICByZXR1cm4gaGFuZGxlcihyZXEsIHJlcyk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcclxuICAgICAgICAgIGNvZGU6IDQwMSxcclxuICAgICAgICAgIG1lc3NhZ2U6IFwi5peg5pWI55qEdG9rZW5cIixcclxuICAgICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCLorqTor4HkuK3pl7Tku7bplJnor686XCIsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICBjb2RlOiA1MDAsXHJcbiAgICAgICAgbWVzc2FnZTogXCLmnI3liqHlmajplJnor69cIixcclxuICAgICAgICBkYXRhOiBudWxsLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcm9sZUNoZWNrKHJvbGVzOiBzdHJpbmdbXSkge1xyXG4gIHJldHVybiAoaGFuZGxlcjogQXBpSGFuZGxlcikgPT4ge1xyXG4gICAgcmV0dXJuIGFzeW5jIChyZXE6IEF1dGhlbnRpY2F0ZWRSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkgPT4ge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlcjtcclxuXHJcbiAgICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xyXG4gICAgICAgICAgICBjb2RlOiA0MDEsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwi6K+35YWI55m75b2VXCIsXHJcbiAgICAgICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghcm9sZXMuaW5jbHVkZXModXNlci5yb2xlKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcclxuICAgICAgICAgICAgY29kZTogNDAzLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiBcIuadg+mZkOS4jei2s1wiLFxyXG4gICAgICAgICAgICBkYXRhOiBudWxsLFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gaGFuZGxlcihyZXEsIHJlcyk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIuinkuiJsuajgOafpeS4remXtOS7tumUmeivrzpcIiwgZXJyb3IpO1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICBjb2RlOiA1MDAsXHJcbiAgICAgICAgICBtZXNzYWdlOiBcIuacjeWKoeWZqOmUmeivr1wiLFxyXG4gICAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9O1xyXG59XHJcbiJdLCJuYW1lcyI6WyJqd3QiLCJhdXRoTWlkZGxld2FyZSIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJzdGFydHNXaXRoIiwic3RhdHVzIiwianNvbiIsImNvZGUiLCJtZXNzYWdlIiwiZGF0YSIsInRva2VuIiwic3BsaXQiLCJzZWNyZXQiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsImNvbnNvbGUiLCJlcnJvciIsImRlY29kZWQiLCJ2ZXJpZnkiLCJ1c2VyIiwicm9sZUNoZWNrIiwicm9sZXMiLCJpbmNsdWRlcyIsInJvbGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./middleware/auth.ts\n");

/***/ }),

/***/ "(api)/./pages/api/upload/merge.ts":
/*!***********************************!*\
  !*** ./pages/api/upload/merge.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _middleware_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../middleware/auth */ \"(api)/./middleware/auth.ts\");\n\n\n\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            code: 405,\n            message: \"方法不允许\",\n            data: null\n        });\n    }\n    try {\n        const { fileName, chunks } = req.body;\n        if (!fileName || !chunks) {\n            return res.status(400).json({\n                code: 400,\n                message: \"参数不完整\",\n                data: null\n            });\n        }\n        const tempDir = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"uploads\", \"temp\", fileName);\n        const uploadDir = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"uploads\", \"files\");\n        // 确保上传目录存在\n        if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(uploadDir)) {\n            fs__WEBPACK_IMPORTED_MODULE_0___default().mkdirSync(uploadDir, {\n                recursive: true\n            });\n        }\n        // 检查所有分片是否存在\n        for(let i = 0; i < parseInt(chunks); i++){\n            const chunkPath = path__WEBPACK_IMPORTED_MODULE_1___default().join(tempDir, `${i}`);\n            if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(chunkPath)) {\n                return res.status(400).json({\n                    code: 400,\n                    message: `分片 ${i} 缺失，合并失败`,\n                    data: null\n                });\n            }\n        }\n        // 合并文件\n        const filePath = path__WEBPACK_IMPORTED_MODULE_1___default().join(uploadDir, fileName);\n        const writeStream = fs__WEBPACK_IMPORTED_MODULE_0___default().createWriteStream(filePath);\n        for(let i = 0; i < parseInt(chunks); i++){\n            const chunkPath = path__WEBPACK_IMPORTED_MODULE_1___default().join(tempDir, `${i}`);\n            const chunkData = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(chunkPath);\n            writeStream.write(chunkData);\n            // 删除分片\n            fs__WEBPACK_IMPORTED_MODULE_0___default().unlinkSync(chunkPath);\n        }\n        writeStream.end();\n        // 删除临时目录\n        fs__WEBPACK_IMPORTED_MODULE_0___default().rmdirSync(tempDir);\n        // 生成文件URL (使用encodeURIComponent处理中文文件名)\n        const encodedFileName = encodeURIComponent(fileName);\n        const fileUrl = `/files/${encodedFileName}`;\n        return res.status(200).json({\n            code: 200,\n            message: \"文件合并成功\",\n            data: {\n                url: fileUrl\n            }\n        });\n    } catch (error) {\n        console.error(error);\n        return res.status(500).json({\n            code: 500,\n            message: \"服务器错误\",\n            data: null\n        });\n    }\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_middleware_auth__WEBPACK_IMPORTED_MODULE_2__.authMiddleware)(handler));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvdXBsb2FkL21lcmdlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUNvQjtBQUNJO0FBQ2tDO0FBRTFELGVBQWVHLFFBQVFDLEdBQW1CLEVBQUVDLEdBQW9CO0lBQzlELElBQUlELElBQUlFLE1BQU0sS0FBSyxRQUFRO1FBQ3pCLE9BQU9ELElBQ0pFLE1BQU0sQ0FBQyxLQUNQQyxJQUFJLENBQUM7WUFBRUMsTUFBTTtZQUFLQyxTQUFTO1lBQVNDLE1BQU07UUFBSztJQUNwRDtJQUVBLElBQUk7UUFDRixNQUFNLEVBQUVDLFFBQVEsRUFBRUMsTUFBTSxFQUFFLEdBQUdULElBQUlVLElBQUk7UUFFckMsSUFBSSxDQUFDRixZQUFZLENBQUNDLFFBQVE7WUFDeEIsT0FBT1IsSUFDSkUsTUFBTSxDQUFDLEtBQ1BDLElBQUksQ0FBQztnQkFBRUMsTUFBTTtnQkFBS0MsU0FBUztnQkFBU0MsTUFBTTtZQUFLO1FBQ3BEO1FBRUEsTUFBTUksVUFBVWQsZ0RBQVMsQ0FBQ2dCLFFBQVFDLEdBQUcsSUFBSSxXQUFXLFFBQVFOO1FBQzVELE1BQU1PLFlBQVlsQixnREFBUyxDQUFDZ0IsUUFBUUMsR0FBRyxJQUFJLFdBQVc7UUFFdEQsV0FBVztRQUNYLElBQUksQ0FBQ2xCLG9EQUFhLENBQUNtQixZQUFZO1lBQzdCbkIsbURBQVksQ0FBQ21CLFdBQVc7Z0JBQUVHLFdBQVc7WUFBSztRQUM1QztRQUVBLGFBQWE7UUFDYixJQUFLLElBQUlDLElBQUksR0FBR0EsSUFBSUMsU0FBU1gsU0FBU1UsSUFBSztZQUN6QyxNQUFNRSxZQUFZeEIsZ0RBQVMsQ0FBQ2MsU0FBUyxDQUFDLEVBQUVRLEVBQUUsQ0FBQztZQUMzQyxJQUFJLENBQUN2QixvREFBYSxDQUFDeUIsWUFBWTtnQkFDN0IsT0FBT3BCLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQzFCQyxNQUFNO29CQUNOQyxTQUFTLENBQUMsR0FBRyxFQUFFYSxFQUFFLFFBQVEsQ0FBQztvQkFDMUJaLE1BQU07Z0JBQ1I7WUFDRjtRQUNGO1FBRUEsT0FBTztRQUNQLE1BQU1lLFdBQVd6QixnREFBUyxDQUFDa0IsV0FBV1A7UUFDdEMsTUFBTWUsY0FBYzNCLDJEQUFvQixDQUFDMEI7UUFFekMsSUFBSyxJQUFJSCxJQUFJLEdBQUdBLElBQUlDLFNBQVNYLFNBQVNVLElBQUs7WUFDekMsTUFBTUUsWUFBWXhCLGdEQUFTLENBQUNjLFNBQVMsQ0FBQyxFQUFFUSxFQUFFLENBQUM7WUFDM0MsTUFBTU0sWUFBWTdCLHNEQUFlLENBQUN5QjtZQUNsQ0UsWUFBWUksS0FBSyxDQUFDRjtZQUNsQixPQUFPO1lBQ1A3QixvREFBYSxDQUFDeUI7UUFDaEI7UUFFQUUsWUFBWU0sR0FBRztRQUVmLFNBQVM7UUFDVGpDLG1EQUFZLENBQUNlO1FBRWIsd0NBQXdDO1FBQ3hDLE1BQU1vQixrQkFBa0JDLG1CQUFtQnhCO1FBQzNDLE1BQU15QixVQUFVLENBQUMsT0FBTyxFQUFFRixnQkFBZ0IsQ0FBQztRQUUzQyxPQUFPOUIsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQkMsTUFBTTtZQUNOQyxTQUFTO1lBQ1RDLE1BQU07Z0JBQ0oyQixLQUFLRDtZQUNQO1FBQ0Y7SUFDRixFQUFFLE9BQU9FLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDQTtRQUNkLE9BQU9sQyxJQUNKRSxNQUFNLENBQUMsS0FDUEMsSUFBSSxDQUFDO1lBQUVDLE1BQU07WUFBS0MsU0FBUztZQUFTQyxNQUFNO1FBQUs7SUFDcEQ7QUFDRjtBQUVBLGlFQUFlVCxnRUFBY0EsQ0FBQ0MsUUFBUUEsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL215X3ByYS8uL3BhZ2VzL2FwaS91cGxvYWQvbWVyZ2UudHM/NWNhYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tIFwibmV4dFwiO1xyXG5pbXBvcnQgZnMgZnJvbSBcImZzXCI7XHJcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XHJcbmltcG9ydCB7IGF1dGhNaWRkbGV3YXJlIH0gZnJvbSBcIi4uLy4uLy4uL21pZGRsZXdhcmUvYXV0aFwiO1xyXG5cclxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkge1xyXG4gIGlmIChyZXEubWV0aG9kICE9PSBcIlBPU1RcIikge1xyXG4gICAgcmV0dXJuIHJlc1xyXG4gICAgICAuc3RhdHVzKDQwNSlcclxuICAgICAgLmpzb24oeyBjb2RlOiA0MDUsIG1lc3NhZ2U6IFwi5pa55rOV5LiN5YWB6K64XCIsIGRhdGE6IG51bGwgfSk7XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBmaWxlTmFtZSwgY2h1bmtzIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICBpZiAoIWZpbGVOYW1lIHx8ICFjaHVua3MpIHtcclxuICAgICAgcmV0dXJuIHJlc1xyXG4gICAgICAgIC5zdGF0dXMoNDAwKVxyXG4gICAgICAgIC5qc29uKHsgY29kZTogNDAwLCBtZXNzYWdlOiBcIuWPguaVsOS4jeWujOaVtFwiLCBkYXRhOiBudWxsIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRlbXBEaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgXCJ1cGxvYWRzXCIsIFwidGVtcFwiLCBmaWxlTmFtZSk7XHJcbiAgICBjb25zdCB1cGxvYWREaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgXCJ1cGxvYWRzXCIsIFwiZmlsZXNcIik7XHJcblxyXG4gICAgLy8g56Gu5L+d5LiK5Lyg55uu5b2V5a2Y5ZyoXHJcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmModXBsb2FkRGlyKSkge1xyXG4gICAgICBmcy5ta2RpclN5bmModXBsb2FkRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDmo4Dmn6XmiYDmnInliIbniYfmmK/lkKblrZjlnKhcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFyc2VJbnQoY2h1bmtzKTsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IGNodW5rUGF0aCA9IHBhdGguam9pbih0ZW1wRGlyLCBgJHtpfWApO1xyXG4gICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoY2h1bmtQYXRoKSkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgICBjb2RlOiA0MDAsXHJcbiAgICAgICAgICBtZXNzYWdlOiBg5YiG54mHICR7aX0g57y65aSx77yM5ZCI5bm25aSx6LSlYCxcclxuICAgICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDlkIjlubbmlofku7ZcclxuICAgIGNvbnN0IGZpbGVQYXRoID0gcGF0aC5qb2luKHVwbG9hZERpciwgZmlsZU5hbWUpO1xyXG4gICAgY29uc3Qgd3JpdGVTdHJlYW0gPSBmcy5jcmVhdGVXcml0ZVN0cmVhbShmaWxlUGF0aCk7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXJzZUludChjaHVua3MpOyBpKyspIHtcclxuICAgICAgY29uc3QgY2h1bmtQYXRoID0gcGF0aC5qb2luKHRlbXBEaXIsIGAke2l9YCk7XHJcbiAgICAgIGNvbnN0IGNodW5rRGF0YSA9IGZzLnJlYWRGaWxlU3luYyhjaHVua1BhdGgpO1xyXG4gICAgICB3cml0ZVN0cmVhbS53cml0ZShjaHVua0RhdGEpO1xyXG4gICAgICAvLyDliKDpmaTliIbniYdcclxuICAgICAgZnMudW5saW5rU3luYyhjaHVua1BhdGgpO1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlU3RyZWFtLmVuZCgpO1xyXG5cclxuICAgIC8vIOWIoOmZpOS4tOaXtuebruW9lVxyXG4gICAgZnMucm1kaXJTeW5jKHRlbXBEaXIpO1xyXG5cclxuICAgIC8vIOeUn+aIkOaWh+S7tlVSTCAo5L2/55SoZW5jb2RlVVJJQ29tcG9uZW505aSE55CG5Lit5paH5paH5Lu25ZCNKVxyXG4gICAgY29uc3QgZW5jb2RlZEZpbGVOYW1lID0gZW5jb2RlVVJJQ29tcG9uZW50KGZpbGVOYW1lKTtcclxuICAgIGNvbnN0IGZpbGVVcmwgPSBgL2ZpbGVzLyR7ZW5jb2RlZEZpbGVOYW1lfWA7XHJcblxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgY29kZTogMjAwLFxyXG4gICAgICBtZXNzYWdlOiBcIuaWh+S7tuWQiOW5tuaIkOWKn1wiLFxyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgdXJsOiBmaWxlVXJsLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlc1xyXG4gICAgICAuc3RhdHVzKDUwMClcclxuICAgICAgLmpzb24oeyBjb2RlOiA1MDAsIG1lc3NhZ2U6IFwi5pyN5Yqh5Zmo6ZSZ6K+vXCIsIGRhdGE6IG51bGwgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhdXRoTWlkZGxld2FyZShoYW5kbGVyKTtcclxuIl0sIm5hbWVzIjpbImZzIiwicGF0aCIsImF1dGhNaWRkbGV3YXJlIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJjb2RlIiwibWVzc2FnZSIsImRhdGEiLCJmaWxlTmFtZSIsImNodW5rcyIsImJvZHkiLCJ0ZW1wRGlyIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJ1cGxvYWREaXIiLCJleGlzdHNTeW5jIiwibWtkaXJTeW5jIiwicmVjdXJzaXZlIiwiaSIsInBhcnNlSW50IiwiY2h1bmtQYXRoIiwiZmlsZVBhdGgiLCJ3cml0ZVN0cmVhbSIsImNyZWF0ZVdyaXRlU3RyZWFtIiwiY2h1bmtEYXRhIiwicmVhZEZpbGVTeW5jIiwid3JpdGUiLCJ1bmxpbmtTeW5jIiwiZW5kIiwicm1kaXJTeW5jIiwiZW5jb2RlZEZpbGVOYW1lIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwiZmlsZVVybCIsInVybCIsImVycm9yIiwiY29uc29sZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/upload/merge.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload%2Fmerge&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cupload%5Cmerge.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();